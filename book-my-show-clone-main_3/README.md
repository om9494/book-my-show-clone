# 🎬 MovieController – BookMyShow Clone

This controller handles all movie-related operations in the BookMyShow clone. It allows users or admins to add, update, delete, and retrieve movies, including viewing total revenue generated from movie bookings.

---

## 🛠 Technologies Used

- Java 17+
- Spring Boot 3.x
- Spring Data JPA
- Hibernate
- Lombok
- Jakarta Validation
- MySQL / PostgreSQL
- Postman (for testing)

---

## 📌 Endpoints

### 1. POST /movies/add – Add a new movie

Adds a movie to the database. Requires a valid JSON body.

#### ✅ Request Body:

{
  "movieName": "Interstellar",
  "duration": 169,
  "rating": 8.6,
  "releaseDate": "2014-11-07",
  "genre": "SCI_FI",
  "language": "ENGLISH",
  "imageUrl": "https://example.com/interstellar.jpg"
}

#### ✅ Response:
The movie has been added successfully

---

### 2. GET /movies/{name} – Get movie by name

Retrieves a movie based on its exact name.

#### Example:
GET /movies/Interstellar

#### ✅ Response:

{
  "id": 1,
  "movieName": "Interstellar",
  "duration":  169,
  "rating": 8.6,
  "releaseDate": "2014-11-07",
  "genre": "SCI_FI",
  "language": "ENGLISH",
  "imageUrl": "https://example.com/interstellar.jpg"
}

---

### 3. GET /movies/id/{id} – Get movie by ID

Retrieves a movie using its unique database ID.

#### Example:
GET /movies/id/1

---

### 4. GET /movies/all – List all movies

Fetches all movies available in the database.

#### Example:
GET /movies/all

#### ✅ Response:

[
  {
    "id": 1,
    "movieName": "Interstellar",
    "duration": 169,
    "rating": 8.6,
    "releaseDate": "2014-11-07",
    "genre": "SCI_FI",
    "language": "ENGLISH",
    "imageUrl": "https://example.com/interstellar.jpg"
  },
  ...
]

---

### 5. GET /movies/totalCollection/{movieId} – Total collection

Returns total revenue generated by a movie based on ticket sales from all its shows.

#### Example:
GET /movies/totalCollection/1

#### ✅ Response:
5600

---

### 6. PUT /movies/{id} – Update a movie

Updates an existing movie’s details.

#### Example:
PUT /movies/1

#### ✅ Request Body:

{
  "movieName": "Inception (Updated)",
  "duration": 148,
  "rating": 9.0,
  "releaseDate": "2010-07-16",
  "genre": "SCI_FI",
  "language": "ENGLISH",
  "imageUrl": "https://example.com/inception-new.jpg"
}

#### ✅ Response:
Movie updated successfully

---

### 7. DELETE /movies/{id} – Delete a movie

Removes a movie by ID.

#### Example:
DELETE /movies/1

#### ✅ Response:
Movie deleted successfully

---

## ⚠️ Error Handling

- MovieDoesNotExists – Thrown when trying to fetch/delete/update a non-existent movie
- MovieAlreadyPresentWithSameNameAndLanguage – Thrown on duplicate movie addition

#### Example Response:

{
  "timestamp": "2025-06-24T17:50:25.123+00:00",
  "status": 404,
  "error": "Not Found",
  "message": "Movie with given ID does not exist",
  "path": "/movies/id/999"
}

---

## 🔍 How to Test Using Postman

1. Start your Spring Boot server (http://localhost:8080)
2. Use Postman to send requests to the above endpoints
3. Use JSON (raw → application/json) for POST/PUT
4. Use proper movieId or movieName values that already exist in the database

---

## ✅ Example Enum Values

Genre:
- ACTION, COMEDY, DRAMA, ROMANCE, SCI_FI, THRILLER

Language:
- ENGLISH, HINDI, MARATHI, TAMIL, TELUGU

---

## 📂 File Structure Related to MovieController

├── Controllers
│   └── MovieController.java
├── Services
│   └── MovieService.java
├── Models
│   └── Movie.java
├── Repositories
│   └── MovieRepository.java
├── Dtos
│   └── RequestDtos
│       └── MovieEntryDto.java
├── Exceptions
│   └── MovieDoesNotExists.java
│   └── MovieAlreadyPresentWithSameNameAndLanguage.java
├── Transformers
│   └── MovieTransformer.java

---

## 📌 Notes

- Movie names should be unique per language.
- You can further extend with filtering (e.g., by genre/language), pagination, etc.
- All requests and responses follow REST best practices and return appropriate HTTP status codes.


# 🎟️ BookingController - BookMyShow Clone

The `BookingController` handles all operations related to booking movie tickets in the BookMyShow clone application. This includes creating bookings (ticket reservations), retrieving booking details, listing user bookings, and canceling tickets.

---

## 📁 Controller: `BookingController.java`

### 🔗 Base URL

```
/bookings
```

---

## ✅ Endpoints

---

### 1. Book Ticket

- **URL:** `POST /bookings`
- **Description:** Book seats for a show by a specific user.
- **Request Body:**

```json
{
  "userId": 1,
  "showId": 5,
  "seatNumbers": ["A1", "A2", "A3"]
}
```

- **Success Response:**

```http
201 Created
Booking successful! Ticket ID: 12
```

- **Failure Response:**

```http
400 Bad Request
Booking failed: Some seats are already booked or do not exist.
```

---

### 2. Get Booking by ID

- **URL:** `GET /bookings/{id}`
- **Description:** Fetch detailed information of a booking using its ticket ID.
- **Path Variable:** `id` - Ticket ID
- **Success Response:**

```json
{
  "ticketId": 12,
  "totalTicketsPrice": 450,
  "bookedSeats": "A1,A2,A3",
  "bookedAt": "2025-06-28",
  "show": { ... },
  "user": { ... }
}
```

- **Failure Response:**

```http
404 Not Found
Booking not found
```

---

### 3. Get All Bookings by User

- **URL:** `GET /bookings/user/{userId}`
- **Description:** Retrieve all bookings made by a specific user.
- **Path Variable:** `userId` - User ID
- **Success Response:**

```json
[
  {
    "ticketId": 12,
    "totalTicketsPrice": 450,
    "bookedSeats": "A1,A2,A3",
    "bookedAt": "2025-06-28",
    "show": { ... }
  },
  {
    "ticketId": 14,
    "totalTicketsPrice": 300,
    "bookedSeats": "B1,B2",
    "bookedAt": "2025-06-29",
    "show": { ... }
  }
]
```

---

### 4. Cancel Booking

- **URL:** `DELETE /bookings/{id}`
- **Description:** Cancel a booking and free up the associated seats.
- **Path Variable:** `id` - Ticket ID
- **Success Response:**

```http
200 OK
Booking cancelled successfully.
```

- **Failure Response:**

```http
400 Bad Request
Cancellation failed: Booking not found
```

---

## 📦 Related DTO

### `BookingRequestDto.java`

```java
@Data
public class BookingRequestDto {
    private Integer userId;
    private Integer showId;
    private List<String> seatNumbers;
}
```

---

## 🧠 Notes

- Booking fails if:
  - Any selected seat is already booked.
  - User or Show ID is invalid.
- When a booking is canceled:
  - The seats become available again for others to book.
- Each ticket is linked to:
  - A `User`
  - A `Show`
  - A list of `ShowSeats` via seat numbers stored as CSV.

---

## 📂 Related Exception

### `UserDoesNotExist.java`

```java
public class UserDoesNotExist extends RuntimeException {
    public UserDoesNotExist() {
        super("User does not exist with the provided ID.");
    }
}
```

---

## ✅ Tips for Testing

- Use Postman or Swagger UI to test the endpoints.
- Make sure `ShowSeat` data is preloaded and marked available before testing bookings.
- Always test edge cases:
  - Same seat booked twice.
  - Booking with wrong user or show ID.

---

> Created with ❤️ by your BookMyShow Clone Dev Team.
